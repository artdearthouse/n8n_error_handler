{
    "name": "Error Processor",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "minutes"
                        }
                    ]
                }
            },
            "name": "Schedule",
            "type": "n8n-nodes-base.cron",
            "typeVersion": 1,
            "position": [
                100,
                300
            ]
        },
        {
            "parameters": {
                "operation": "executeQuery",
                "query": "SELECT * FROM error_logs WHERE sent_to_tg = FALSE AND processing_attempts < 5 ORDER BY timestamp ASC LIMIT 50"
            },
            "name": "Fetch Pending",
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 1,
            "position": [
                300,
                300
            ],
            "credentials": {
                "postgres": {
                    "id": "YOUR_POSTGRES_CREDENTIAL_ID",
                    "name": "Postgres Default"
                }
            }
        },
        {
            "parameters": {
                "batchSize": 1,
                "options": {}
            },
            "name": "SplitInBatches",
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 1,
            "position": [
                500,
                300
            ]
        },
        {
            "parameters": {
                "chatId": "YOUR_CHAT_ID",
                "text": "=âš ï¸ **Error in {{$json.workflow_name}}**\n\nðŸ“„ Execution: `{{$json.execution_id}}`\nâŒ Message: {{$json.error_message}}",
                "additionalFields": {
                    "messgeThreadId": "YOUR_THREAD_ID"
                }
            },
            "name": "Telegram",
            "type": "n8n-nodes-base.telegram",
            "typeVersion": 1,
            "position": [
                700,
                200
            ],
            "credentials": {
                "telegramApi": {
                    "id": "YOUR_TELEGRAM_CREDENTIAL_ID",
                    "name": "Telegram Default"
                }
            },
            "continueOnFail": true
        },
        {
            "parameters": {
                "url": "YOUR_WEBHOOK_URL",
                "method": "POST",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{JSON.stringify($json)}}"
            },
            "name": "Webhook Fallback",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.1,
            "position": [
                900,
                400
            ]
        },
        {
            "parameters": {
                "operation": "executeQuery",
                "query": "UPDATE error_logs SET sent_to_tg = TRUE WHERE id = $1",
                "additionalFields": {
                    "queryParams": "={{$json.id}}"
                }
            },
            "name": "Mark Sent",
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 1,
            "position": [
                1100,
                200
            ],
            "credentials": {
                "postgres": {
                    "id": "YOUR_POSTGRES_CREDENTIAL_ID",
                    "name": "Postgres Default"
                }
            }
        },
        {
            "parameters": {
                "operation": "executeQuery",
                "query": "UPDATE error_logs SET processing_attempts = processing_attempts + 1, last_attempt = NOW() WHERE id = $1",
                "additionalFields": {
                    "queryParams": "={{$json.id}}"
                }
            },
            "name": "Mark Failed",
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 1,
            "position": [
                1100,
                500
            ],
            "credentials": {
                "postgres": {
                    "id": "YOUR_POSTGRES_CREDENTIAL_ID",
                    "name": "Postgres Default"
                }
            }
        }
    ],
    "connections": {
        "Schedule": {
            "main": [
                [
                    {
                        "node": "Fetch Pending",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Fetch Pending": {
            "main": [
                [
                    {
                        "node": "SplitInBatches",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "SplitInBatches": {
            "main": [
                [
                    {
                        "node": "Telegram",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Telegram": {
            "main": [
                [
                    {
                        "node": "Mark Sent",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Webhook Fallback",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Webhook Fallback": {
            "main": [
                [
                    {
                        "node": "Mark Sent",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Mark Failed",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {},
    "staticData": null,
    "tags": []
}